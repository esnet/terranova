import pytest
from terranova.datasources.google_sheets.fetcher import CacheWriter

# from terranova.logging import logger

# This fixture is only intended to be used
# to bootstrap the unit testing
# It does not return anything useful


# List of circuits that will populate the fixture
# esdb cache for use in unit testing
# These were taken as examples from what the
# esdb_fetcher.fetcher generates
CIRCUITS = [
    {
        "id": 7,
        "uuid": "b64ff576-5a38-4321-820e-0cc151e9ae44",
        "orchestrator_id": None,
        "url": "https://esdb.es.net/esdb_api/v1/circuit/7/",
        "circuit_id": "ESNET-Z00007",
        "circuit_state": 4,
        "circuit_type": 3,
        "customer_of_record": 73,
        "customer_of_record_circuit_id": None,
        "dependents": [],
        "depends_on": None,
        "description": "GA-SDSC-10G-DF",
        "details": {},
        "endpoints": [
            {
                "id": 4669,
                "url": "https://esdb.es.net/esdb_api/v1/endpoint/4669/",
                "description": None,
                "details": {},
                "endpoint_type": 1,
                "device_name": None,
                "interface": None,
                "foreign_description": None,
                "organization": None,
                "panel_name": "ga-mfp1",
                "port_id": "3/4-LC-UPC",
                "port_side": "BACK",
                "port_location": 31,
                "name": "ga-mfp1:3/4-LC-UPC:BACK",
                "equipment_port": None,
                "patch_panel_port": 490,
                "interface_as_int": 1,
                "latitude": "32.89381960",
                "longitude": "-117.23594450",
                "location_name": "GA-Campus",
            },
            {
                "id": 5392,
                "url": "https://esdb.es.net/esdb_api/v1/endpoint/5392/",
                "description": None,
                "details": {},
                "endpoint_type": 1,
                "device_name": None,
                "interface": None,
                "foreign_description": None,
                "organization": None,
                "panel_name": "SDSC-L5",
                "port_id": "1/2-LC-UPC",
                "port_side": "BACK",
                "port_location": 104,
                "name": "SDSC-L5:1/2-LC-UPC:BACK",
                "equipment_port": None,
                "patch_panel_port": 501,
                "interface_as_int": 1,
                "latitude": "32.88435520",
                "longitude": "-117.23380660",
                "location_name": "SDSC-HUB",
            },
        ],
        "fiber_distance": None,
        "fiber_type": "Single-Mode Fiber",
        "grouped_by": {"type": None, "circuit": None},
        "groups": {"type": None, "circuits": []},
        "identifier": None,
        "light_levels": None,
        "notepad": "10GE link over dark fiber (upgraded to from\r\n1G -> 10G on May 2010\r\nDark-fiber between the GA-RT2 MX480 and the\r\nSDSC-SDN2 MX480\r\n\r\n\r\n*GA-RT2*\r\ncrotermund@ga-rt2-re0> show system uptime| match time \r\nCurrent time: 2013-01-07 14:05:09 PST\r\n\r\n{master}\r\ncrotermund@ga-rt2-re0> show interfaces diagnostics optics xe-0/0/0 \r\nPhysical interface: xe-0/0/0\r\n    Laser bias current                        :  42.032 mA\r\n    Laser output power                        :  1.3270 mW / 1.23 dBm\r\n    Module temperature                        :  34 degrees C / 93 degrees F\r\n    Laser rx power                            :  0.4108 mW / -3.86 dBm\r\n\r\n*SDSC-SDN2*\r\ncrotermund@sdsc-sdn2-re0> show system uptime |match time \r\nCurrent time: 2013-01-07 14:06:07 PST\r\n\r\n{master}\r\ncrotermund@sdsc-sdn2-re0> show interfaces diagnostics optics xe-1/1/0 \r\nPhysical interface: xe-1/1/0\r\n    Laser bias current                        :  47.113 mA\r\n    Laser output power                        :  1.3220 mW / 1.21 dBm\r\n    Module temperature                        :  39 degrees C / 101 degrees F\r\n    Laser rx power                            :  0.5352 mW / -2.71 dBm\r\n\r\n\r\nUpgraded from ATM--> GE on June17 2005",  # noqa: E501
        "provider": 73,
        "provider_circuit_id": "GA-SDSC-10G-DF",
        "channel": None,
        "po_entry": None,
        "notepad_can_be_deleted": 0,
        "tags": [],
        "circuit_state_name": "In-service",
        "circuit_type_name": "Dark Fiber",
        "customer_of_record_name": "GA",
        "provider_name": "GA",
        "location_tags": ["ESnet5"],
        "circuit_speed": 1000,
        "circuit_speed_name": "1G",
    },
    {
        "id": 72,
        "uuid": "b9882c1d-9fac-4b99-a081-c662f963c251",
        "orchestrator_id": None,
        "url": "https://esdb.es.net/esdb_api/v1/circuit/72/",
        "circuit_id": "ESNET-Z00072",
        "circuit_state": 4,
        "circuit_type": 4,
        "customer_of_record": 135,
        "customer_of_record_circuit_id": None,
        "dependents": [],
        "depends_on": None,
        "description": "snla-rt1:xe-0/1/3 vlan 31",
        "details": {},
        "endpoints": [
            {
                "id": 28558,
                "url": "https://esdb.es.net/esdb_api/v1/endpoint/28558/",
                "description": None,
                "details": {},
                "endpoint_type": 1,
                "device_name": None,
                "interface": None,
                "foreign_description": None,
                "organization": None,
                "panel_name": "SNLNM-FBP1",
                "port_id": "1-A-4A/4B-LC-UPC",
                "port_side": "FRONT",
                "port_location": 631,
                "name": "SNLNM-FBP1:1-A-4A/4B-LC-UPC:FRONT",
                "equipment_port": None,
                "patch_panel_port": 2661,
                "interface_as_int": 1,
                "latitude": "35.06062330",
                "longitude": "-106.53463770",
                "location_name": "SNLNM",
            },
            {
                "id": 143,
                "url": "https://esdb.es.net/esdb_api/v1/endpoint/143/",
                "description": "",
                "details": {},
                "endpoint_type": 3,
                "device_name": None,
                "interface": None,
                "foreign_description": "Site",
                "organization": 135,
                "panel_name": None,
                "port_id": None,
                "port_side": None,
                "port_location": None,
                "name": "DOE-NNSA-ALBQ:Site",
                "equipment_port": None,
                "patch_panel_port": None,
                "interface_as_int": 1,
                "latitude": 0,
                "longitude": 0,
                "location_name": "DOE-NNSA-ALBQ",
            },
        ],
        "fiber_distance": None,
        "fiber_type": "Single-Mode Fiber",
        "grouped_by": {"type": None, "circuit": None},
        "groups": {"type": None, "circuits": []},
        "identifier": None,
        "light_levels": None,
        "notepad": "Moved to SNLA-RT3 ge-1/1/3 \r\n\r\n\r\nMoved to SNLA-RT2 FE-1/0/2 to ge-0/1/2 Jan-17-2012\r\n\r\n\r\njvg@snla-rt2-re1> show interfaces diagnostics optics ge-0/1/2   \r\nPhysical interface: ge-0/1/2\r\n    Laser bias current               :  6.630 mA\r\n    Laser output power             :  0.1800 mW / -7.45 dBm\r\n    Module temperature            :  38 degrees C / 101 degrees F\r\n    Module voltage                   :  3.2440 V\r\n    Receiver signal ave. optical power  :  0.0613 mW / -12.13 dBm\r\n",  # noqa: E501
        "provider": 135,
        "provider_circuit_id": "snla-rt1:xe-0/1/3 vlan 31",
        "channel": None,
        "po_entry": None,
        "notepad_can_be_deleted": 0,
        "tags": [],
        "circuit_state_name": "In-service",
        "circuit_type_name": "Equipment-Equipment",
        "customer_of_record_name": "DOE-NNSA-ALBQ",
        "provider_name": "DOE-NNSA-ALBQ",
        "location_tags": ["ESnet6", "Low Speed Routing Tier 2"],
        "circuit_speed": 400000,
        "circuit_speed_name": "400G",
    },
    {
        "id": 8994,
        "uuid": "7982c07e-a616-4c80-84ba-e317069f1bd4",
        "orchestrator_id": None,
        "url": "https://esdb.es.net/esdb_api/v1/circuit/8994/",
        "circuit_id": "ESNET-Z08994",
        "circuit_state": 1,
        "circuit_type": 9,
        "customer_of_record": 91,
        "customer_of_record_circuit_id": None,
        "dependents": [],
        "depends_on": None,
        "description": "Fiber Jumper",
        "details": {},
        "endpoints": [
            {
                "id": 22062,
                "url": "https://esdb.es.net/esdb_api/v1/endpoint/22062/",
                "description": None,
                "details": {},
                "endpoint_type": 1,
                "device_name": None,
                "interface": None,
                "foreign_description": None,
                "organization": None,
                "panel_name": "NNSS-FBP1",
                "port_id": "1-A-4A/4B-LC-UPC",
                "port_side": "BACK",
                "port_location": 610,
                "name": "NNSS-FBP1:1-A-4A/4B-LC-UPC:BACK",
                "equipment_port": None,
                "patch_panel_port": 2238,
                "interface_as_int": 1,
                "latitude": "36.20719900",
                "longitude": "-115.13618700",
                "location_name": "NNSS",
            },
            {
                "id": 22038,
                "url": "https://esdb.es.net/esdb_api/v1/endpoint/22038/",
                "description": None,
                "details": {},
                "endpoint_type": 2,
                "device_name": "nnss-cr6",
                "interface": "1/1/c13/4",
                "foreign_description": None,
                "organization": None,
                "panel_name": None,
                "port_id": None,
                "port_side": None,
                "port_location": 610,
                "name": "nnss-cr6:1/1/c13/4",
                "equipment_port": 16647,
                "patch_panel_port": None,
                "interface_as_int": 3792,
                "latitude": "36.20719900",
                "longitude": "-115.13618700",
                "location_name": "NNSS",
            },
        ],
        "fiber_distance": None,
        "fiber_type": None,
        "grouped_by": {"type": None, "circuit": None},
        "groups": {"type": None, "circuits": []},
        "identifier": None,
        "light_levels": None,
        "notepad": None,
        "provider": None,
        "provider_circuit_id": None,
        "channel": None,
        "po_entry": None,
        "notepad_can_be_deleted": 0,
        "tags": [],
        "circuit_state_name": "Planning",
        "circuit_type_name": "Jumper",
        "customer_of_record_name": "ESNET",
        "location_tags": ["ESnet6", "Low Speed Routing Tier 2"],
        # circuit speed intentionally missing
    },
    {
        "id": 10393,
        "uuid": "ed8cd826-9d05-4081-b74f-aa070bac9156",
        "orchestrator_id": None,
        "url": "https://esdb.es.net/esdb_api/v1/circuit/10393/",
        "circuit_id": "ESNET-Z10393",
        "circuit_state": 4,
        "circuit_type": 7,
        "customer_of_record": 91,
        "customer_of_record_circuit_id": None,
        "dependents": [],
        "depends_on": None,
        "description": "",
        "details": {},
        "endpoints": [
            {
                "id": 27877,
                "url": "https://esdb.es.net/esdb_api/v1/endpoint/27877/",
                "description": None,
                "details": {},
                "endpoint_type": 2,
                "device_name": "newy1118th-ols1",
                "interface": "2-A-5-T11",
                "foreign_description": None,
                "organization": None,
                "panel_name": None,
                "port_id": None,
                "port_side": None,
                "port_location": 263,
                "name": "newy1118th-ols1:2-A-5-T11",
                "equipment_port": 21819,
                "patch_panel_port": None,
                "interface_as_int": 6543,
                "latitude": "40.74139600",
                "longitude": "-74.00326600",
                "location_name": "NEWY1118TH",
            },
            {
                "id": 23852,
                "url": "https://esdb.es.net/esdb_api/v1/endpoint/23852/",
                "description": None,
                "details": {},
                "endpoint_type": 2,
                "device_name": "bnl515-ols1",
                "interface": "2-A-1-L1",
                "foreign_description": None,
                "organization": None,
                "panel_name": None,
                "port_id": None,
                "port_side": None,
                "port_location": 597,
                "name": "bnl515-ols1:2-A-1-L1",
                "equipment_port": 18132,
                "patch_panel_port": None,
                "interface_as_int": 6369,
                "latitude": "40.86611160",
                "longitude": "-72.87094710",
                "location_name": "BNL515",
            },
        ],
        "fiber_distance": None,
        "fiber_type": None,
        "grouped_by": {"type": "concatenation", "circuit": 8777},
        "groups": {"type": None, "circuits": []},
        "identifier": None,
        "light_levels": None,
        "notepad": None,
        "provider": None,
        "provider_circuit_id": "",
        "channel": None,
        "po_entry": None,
        "notepad_can_be_deleted": 0,
        "tags": [],
        "circuit_state_name": "In-service",
        "circuit_type_name": "Backplane Mate",
        "customer_of_record_name": "ESNET",
        "location_tags": [
            "Typical Backbone Cabinet",
            "DC",
            "ESnet6",
            "Compact Backbone",
            "Add/Drop",
        ],
        "circuit_speed": 100,
        "circuit_speed_name": "Sub 1G",
    },
    {
        "id": 1191,
        "uuid": "d4004779-cb25-484f-8e85-5ef9025445cb",
        "orchestrator_id": None,
        "url": "https://esdb.es.net/esdb_api/v1/circuit/1191/",
        "circuit_id": "ESNET-Z01191",
        "circuit_state": 4,
        "circuit_type": 9,
        "customer_of_record": None,
        "customer_of_record_circuit_id": None,
        "dependents": [],
        "depends_on": None,
        "description": "Fiber Jumper",
        "details": {},
        "endpoints": [
            {
                "id": 15670,
                "url": "https://esdb.es.net/esdb_api/v1/endpoint/15670/",
                "description": None,
                "details": {},
                "endpoint_type": 2,
                "device_name": "eqxch2-cr6",
                "interface": "1/1/c3/1",
                "foreign_description": None,
                "organization": None,
                "panel_name": None,
                "port_id": None,
                "port_side": None,
                "port_location": 260,
                "name": "eqxch2-cr6:1/1/c3/1",
                "equipment_port": 11945,
                "patch_panel_port": None,
                "interface_as_int": 3483,
                "latitude": "41.85364950",
                "longitude": "-87.61834220",
                "location_name": "EQXCH2",
            },
            {
                "id": 29112,
                "url": "https://esdb.es.net/esdb_api/v1/endpoint/29112/",
                "description": None,
                "details": {},
                "endpoint_type": 1,
                "device_name": None,
                "interface": None,
                "foreign_description": None,
                "organization": None,
                "panel_name": "CH2:06:004115:ESNET:6796 PP:0000:1174592",
                "port_id": "23/24-LC-UPC",
                "port_side": "FRONT",
                "port_location": 260,
                "name": "CH2:06:004115:ESNET:6796 PP:0000:1174592:23/24-LC-UPC:FRONT",
                "equipment_port": None,
                "patch_panel_port": 2734,
                "interface_as_int": 1,
                "latitude": "41.85364950",
                "longitude": "-87.61834220",
                "location_name": "EQXCH2",
            },
        ],
        "fiber_distance": None,
        "fiber_type": None,
        "grouped_by": {"type": "concatenation", "circuit": 1568},
        "groups": {"type": None, "circuits": []},
        "identifier": None,
        "light_levels": None,
        "notepad": None,
        "provider": None,
        "provider_circuit_id": None,
        "channel": None,
        "po_entry": None,
        "notepad_can_be_deleted": 0,
        "tags": [],
        "circuit_state_name": "In-service",
        "circuit_type_name": "Jumper",
        "location_tags": ["ESnet6", "AC", "Add/Drop", "Large Backbone"],
        "circuit_speed": 1000,
        "circuit_speed_name": "1G",
    },
    {
        "id": 1412,
        "uuid": "cc33117f-36ca-479c-8a25-d2db46640f89",
        "orchestrator_id": None,
        "url": "https://esdb.es.net/esdb_api/v1/circuit/1412/",
        "circuit_id": "ESNET-Z01412",
        "circuit_state": 4,
        "circuit_type": 6,
        "customer_of_record": None,
        "customer_of_record_circuit_id": None,
        "dependents": [],
        "depends_on": None,
        "description": "Panel Coupler 11/12-SC-UPC",
        "details": {},
        "endpoints": [
            {
                "id": 2078,
                "url": "https://esdb.es.net/esdb_api/v1/endpoint/2078/",
                "description": None,
                "details": {},
                "endpoint_type": 1,
                "device_name": None,
                "interface": None,
                "foreign_description": None,
                "organization": None,
                "panel_name": "pp-0109-3812",
                "port_id": "11/12-SC-UPC",
                "port_side": "FRONT",
                "port_location": 136,
                "name": "pp-0109-3812:11/12-SC-UPC:FRONT",
                "equipment_port": None,
                "patch_panel_port": 481,
                "interface_as_int": 1,
                "latitude": "37.24176670",
                "longitude": "-121.78296690",
                "location_name": "EQX-SJ",
            },
            {
                "id": 2079,
                "url": "https://esdb.es.net/esdb_api/v1/endpoint/2079/",
                "description": None,
                "details": {},
                "endpoint_type": 1,
                "device_name": None,
                "interface": None,
                "foreign_description": None,
                "organization": None,
                "panel_name": "pp-0109-3812",
                "port_id": "11/12-SC-UPC",
                "port_side": "BACK",
                "port_location": 136,
                "name": "pp-0109-3812:11/12-SC-UPC:BACK",
                "equipment_port": None,
                "patch_panel_port": 481,
                "interface_as_int": 1,
                "latitude": "37.24176670",
                "longitude": "-121.78296690",
                "location_name": "EQX-SJ",
            },
        ],
        "fiber_distance": None,
        "fiber_type": None,
        "grouped_by": {"type": None, "circuit": None},
        "groups": {"type": None, "circuits": []},
        "identifier": None,
        "light_levels": None,
        "notepad": None,
        "provider": None,
        "provider_circuit_id": None,
        "channel": None,
        "po_entry": None,
        "notepad_can_be_deleted": 0,
        "tags": [],
        "circuit_state_name": "In-service",
        "circuit_type_name": "Panel Coupler",
        "location_tags": ["ESnet5"],
        "circuit_speed": 40000,
        "circuit_speed_name": "40G",
    },
    {
        "id": 544,
        "uuid": "128cf901-5bcf-47a5-92da-42219429db12",
        "orchestrator_id": None,
        "url": "https://esdb.es.net/esdb_api/v1/circuit/544/",
        "circuit_id": "ESNET-Z00544",
        "circuit_state_name": "In-service",
        "circuit_type_name": "Dark Fiber",
        "customer_of_record_name": None,
        "description": "ChiExpress CHIC-STAR dark fiber",
        "endpoints": [
            {
                "id": 888,
                "url": "https://esdb.es.net/esdb_api/v1/endpoint/888/",
                "description": None,
                "device_name": None,
                "interface": None,
                "name": "CFP12/DTV:55/56-SC-UPC:BACK",
                "latitude": 41.897642,
                "longitude": -87.6433909,
                "location_name": "CHIC-HUB",
            },
            {
                "id": 886,
                "url": "https://esdb.es.net/esdb_api/v1/endpoint/886/",
                "description": None,
                "device_name": None,
                "interface": None,
                "name": "RR202.10/FDP RMU36:5/6-SC-UPC:BACK",
                "latitude": 41.8961757,
                "longitude": -87.6173266,
                "location_name": "STAR-HUB",
            },
        ],
        "location_tags": ["ESnet5"],
        # circuit speed intentionally missing
    },
]


@pytest.fixture(autouse=True, scope="session")
def sqlite_database():
    writer = CacheWriter()

    # remap to format that we're expecting in CacheWriter {id: circuit}
    kv_circuits = [circuit for circuit in CIRCUITS]
    writer.insert(kv_circuits, "circuit")

    return 1
